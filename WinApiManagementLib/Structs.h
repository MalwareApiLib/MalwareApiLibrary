#pragma once


#ifndef _STRUCTS_H
#define _STRUCTS_H
#include <Windows.h>

typedef struct _UNICODE_STRING
{
    USHORT Length;
    USHORT MaximumLength;
    PWSTR  Buffer;

} UNICODE_STRING, * PUNICODE_STRING;

typedef struct _OBJECT_ATTRIBUTES {
    ULONG Length;
    PVOID RootDirectory;
    PUNICODE_STRING ObjectName;
    ULONG Attributes;
    PVOID SecurityDescriptor;
    PVOID SecurityQualityOfService;
} OBJECT_ATTRIBUTES, * POBJECT_ATTRIBUTES;

typedef struct _INITIAL_TEB {
    PVOID                StackBase;
    PVOID                StackLimit;
    PVOID                StackCommit;
    PVOID                StackCommitMax;
    PVOID                StackReserved;
} INITIAL_TEB, * PINITIAL_TEB;

typedef enum _SECTION_INHERIT
{
    ViewShare = 1,
    ViewUnmap = 2
} SECTION_INHERIT, * PSECTION_INHERIT;

typedef struct __CLIENT_ID {
    HANDLE UniqueProcess;
    HANDLE UniqueThread;
} CLIENT_ID, * PCLIENT_ID;

typedef struct _TEB_ACTIVE_FRAME_CONTEXT {
    ULONG Flags;
    PCHAR FrameName;
} TEB_ACTIVE_FRAME_CONTEXT, * PTEB_ACTIVE_FRAME_CONTEXT;

typedef struct _TEB_ACTIVE_FRAME {
    ULONG Flags;
    struct _TEB_ACTIVE_FRAME* Previous;
    PTEB_ACTIVE_FRAME_CONTEXT Context;
} TEB_ACTIVE_FRAME, * PTEB_ACTIVE_FRAME;

typedef struct _GDI_TEB_BATCH {
    ULONG Offset;
    ULONG HDC;
    ULONG Buffer[310];
} GDI_TEB_BATCH, * PGDI_TEB_BATCH;

typedef PVOID PACTIVATION_CONTEXT;

typedef struct _RTL_ACTIVATION_CONTEXT_STACK_FRAME {
    struct __RTL_ACTIVATION_CONTEXT_STACK_FRAME* Previous;
    PACTIVATION_CONTEXT ActivationContext;
    ULONG Flags;
} RTL_ACTIVATION_CONTEXT_STACK_FRAME, * PRTL_ACTIVATION_CONTEXT_STACK_FRAME;

typedef struct _ACTIVATION_CONTEXT_STACK {
    PRTL_ACTIVATION_CONTEXT_STACK_FRAME ActiveFrame;
    LIST_ENTRY FrameListCache;
    ULONG Flags;
    ULONG NextCookieSequenceNumber;
    ULONG StackId;
} ACTIVATION_CONTEXT_STACK, * PACTIVATION_CONTEXT_STACK;

typedef struct _LDR_MODULE {
    LIST_ENTRY              InLoadOrderModuleList;
    LIST_ENTRY              InMemoryOrderModuleList;
    LIST_ENTRY              InInitializationOrderModuleList;
    PVOID                   BaseAddress;
    PVOID                   EntryPoint;
    ULONG                   SizeOfImage;
    UNICODE_STRING          FullDllName;
    UNICODE_STRING          BaseDllName;
    ULONG                   Flags;
    SHORT                   LoadCount;
    SHORT                   TlsIndex;
    LIST_ENTRY              HashTableEntry;
    ULONG                   TimeDateStamp;
} LDR_MODULE, * PLDR_MODULE;

typedef struct _PEB_LDR_DATA {
    ULONG                   Length;
    ULONG                   Initialized;
    PVOID                   SsHandle;
    LIST_ENTRY              InLoadOrderModuleList;
    LIST_ENTRY              InMemoryOrderModuleList;
    LIST_ENTRY              InInitializationOrderModuleList;
} PEB_LDR_DATA, * PPEB_LDR_DATA;


typedef struct _LDR_DATA_TABLE_ENTRY {
    LIST_ENTRY InLoadOrderLinks;
    LIST_ENTRY InMemoryOrderLinks;
    LIST_ENTRY InInitializationOrderLinks;
    PVOID DllBase;
    PVOID EntryPoint;
    ULONG SizeOfImage;
    UNICODE_STRING FullDllName;
    UNICODE_STRING BaseDllName;
    ULONG Flags;
    WORD LoadCount;
    WORD TlsIndex;
    union {
        LIST_ENTRY HashLinks;
        struct {
            PVOID SectionPointer;
            ULONG CheckSum;
        };
    };
    union {
        ULONG TimeDateStamp;
        PVOID LoadedImports;
    };
    PACTIVATION_CONTEXT EntryPointActivationContext;
    PVOID PatchInformation;
    LIST_ENTRY ForwarderLinks;
    LIST_ENTRY ServiceTagLinks;
    LIST_ENTRY StaticLinks;
} LDR_DATA_TABLE_ENTRY, * PLDR_DATA_TABLE_ENTRY;

typedef struct _PEB
{
    UCHAR InheritedAddressSpace;                                           
    UCHAR ReadImageFileExecOptions;                                         
    UCHAR BeingDebugged;                                                    
    union
    {
        UCHAR BitField;                                                     
        struct
        {
            UCHAR ImageUsesLargePages : 1;                                    
            UCHAR IsProtectedProcess : 1;                                     
            UCHAR IsImageDynamicallyRelocated : 1;                            
            UCHAR SkipPatchingUser32Forwarders : 1;                           
            UCHAR IsPackagedProcess : 1;                                      
            UCHAR IsAppContainer : 1;                                         
            UCHAR IsProtectedProcessLight : 1;                                
            UCHAR IsLongPathAwareProcess : 1;                                 
        };
    };
    UCHAR Padding0[4];                                                      
    VOID* Mutant;                                                           
    VOID* ImageBaseAddress;                                                 
    struct _PEB_LDR_DATA* Ldr;                                              
    struct _RTL_USER_PROCESS_PARAMETERS* ProcessParameters;                
    VOID* SubSystemData;                                                    
    VOID* ProcessHeap;                                                      
    struct _RTL_CRITICAL_SECTION* FastPebLock;                              
    union _SLIST_HEADER* volatile AtlThunkSListPtr;                        
    VOID* IFEOKey;                                                          
    union
    {
        ULONG CrossProcessFlags;                                            
        struct
        {
            ULONG ProcessInJob : 1;                                          
            ULONG ProcessInitializing : 1;                                    
            ULONG ProcessUsingVEH : 1;                                        
            ULONG ProcessUsingVCH : 1;                                        
            ULONG ProcessUsingFTH : 1;                                        
            ULONG ProcessPreviouslyThrottled : 1;                             
            ULONG ProcessCurrentlyThrottled : 1;                              
            ULONG ProcessImagesHotPatched : 1;                                
            ULONG ReservedBits0 : 24;                                         
        };
    };
    UCHAR Padding1[4];                                                      
    union
    {
        VOID* KernelCallbackTable;                                          
        VOID* UserSharedInfoPtr;                                            
    };
    ULONG SystemReserved;                                                   
    ULONG AtlThunkSListPtr32;                                               
    VOID* ApiSetMap;                                                        
    ULONG TlsExpansionCounter;                                              
    UCHAR Padding2[4];                                                      
    VOID* TlsBitmap;                                                       
    ULONG TlsBitmapBits[2];                                                
    VOID* ReadOnlySharedMemoryBase;                                         
    VOID* SharedData;                                                       
    VOID** ReadOnlyStaticServerData;                                        
    VOID* AnsiCodePageData;                                                 
    VOID* OemCodePageData;                                                  
    VOID* UnicodeCaseTableData;                                             
    ULONG NumberOfProcessors;                                               
    ULONG NtGlobalFlag;                                                     
    union _LARGE_INTEGER CriticalSectionTimeout;                            
    ULONGLONG HeapSegmentReserve;                                          
    ULONGLONG HeapSegmentCommit;                                            
    ULONGLONG HeapDeCommitTotalFreeThreshold;                               
    ULONGLONG HeapDeCommitFreeBlockThreshold;                               
    ULONG NumberOfHeaps;                                                    
    ULONG MaximumNumberOfHeaps;                                             
    VOID** ProcessHeaps;                                                    
    VOID* GdiSharedHandleTable;                                             
    VOID* ProcessStarterHelper;                                             
    ULONG GdiDCAttributeList;                                               
    UCHAR Padding3[4];                                                      
    struct _RTL_CRITICAL_SECTION* LoaderLock;                               
    ULONG OSMajorVersion;                                                   
    ULONG OSMinorVersion;                                                   
    USHORT OSBuildNumber;                                                  
    USHORT OSCSDVersion;                                                    
    ULONG OSPlatformId;                                                     
    ULONG ImageSubsystem;                                                   
    ULONG ImageSubsystemMajorVersion;                                       
    ULONG ImageSubsystemMinorVersion;                                       
    UCHAR Padding4[4];                                                     
    ULONGLONG ActiveProcessAffinityMask;                                    
    ULONG GdiHandleBuffer[60];                                              
    VOID(*PostProcessInitRoutine)();                                      
    VOID* TlsExpansionBitmap;                                               
    ULONG TlsExpansionBitmapBits[32];                                       
    ULONG SessionId;                                                        
    UCHAR Padding5[4];                                                      
    union _ULARGE_INTEGER AppCompatFlags;                                   
    union _ULARGE_INTEGER AppCompatFlagsUser;                               
    VOID* pShimData;                                                        
    VOID* AppCompatInfo;                                                    
    struct _UNICODE_STRING CSDVersion;                                      
    struct _ACTIVATION_CONTEXT_DATA* ActivationContextData;                 
    struct _ASSEMBLY_STORAGE_MAP* ProcessAssemblyStorageMap;                
    struct _ACTIVATION_CONTEXT_DATA* SystemDefaultActivationContextData;    
    struct _ASSEMBLY_STORAGE_MAP* SystemAssemblyStorageMap;                 
    ULONGLONG MinimumStackCommit;                                           
    struct _FLS_CALLBACK_INFO* FlsCallback;                                 
    struct _LIST_ENTRY FlsListHead;                                         
    VOID* FlsBitmap;                                                        
    ULONG FlsBitmapBits[4];                                                 
    ULONG FlsHighIndex;                                                     
    VOID* WerRegistrationData;                                              
    VOID* WerShipAssertPtr;                                                 
    VOID* pUnused;                                                          
    VOID* pImageHeaderHash;                                                 
    union
    {
        ULONG TracingFlags;                                                
        struct
        {
            ULONG HeapTracingEnabled : 1;                                    
            ULONG CritSecTracingEnabled : 1;                                  
            ULONG LibLoaderTracingEnabled : 1;                               
            ULONG SpareTracingBits : 29;                                      
        };
    };
    UCHAR Padding6[4];                                                     
    ULONGLONG CsrServerReadOnlySharedMemoryBase;                            
    ULONGLONG TppWorkerpListLock;                                           
    struct _LIST_ENTRY TppWorkerpList;                                      
    VOID* WaitOnAddressHashTable[128];                                     
    VOID* TelemetryCoverageHeader;                                          
    ULONG CloudFileFlags;                                                   
    ULONG CloudFileDiagFlags;                                              
    CHAR PlaceholderCompatibilityMode;                                      
    CHAR PlaceholderCompatibilityModeReserved[7];                           
    struct _LEAP_SECOND_DATA* LeapSecondData;                              
    union
    {
        ULONG LeapSecondFlags;                                              
        struct
        {
            ULONG SixtySecondEnabled : 1;                                     
            ULONG Reserved : 31;                                              
        };
    };
    ULONG NtGlobalFlag2;                                                    
} PEB, * PPEB;


typedef struct _TEB {
    NT_TIB				NtTib;
    PVOID				EnvironmentPointer;
    CLIENT_ID			ClientId;
    PVOID				ActiveRpcHandle;
    PVOID				ThreadLocalStoragePointer;
    PPEB				ProcessEnvironmentBlock;
    ULONG               LastErrorValue;
    ULONG               CountOfOwnedCriticalSections;
    PVOID				CsrClientThread;
    PVOID				Win32ThreadInfo;
    ULONG               User32Reserved[26];
    ULONG               UserReserved[5];
    PVOID				WOW32Reserved;
    LCID                CurrentLocale;
    ULONG               FpSoftwareStatusRegister;
    PVOID				SystemReserved1[54];
    LONG                ExceptionCode;
#if (NTDDI_VERSION >= NTDDI_LONGHORN)
    PACTIVATION_CONTEXT_STACK* ActivationContextStackPointer;
    UCHAR                  SpareBytes1[0x30 - 3 * sizeof(PVOID)];
    ULONG                  TxFsContext;
#elif (NTDDI_VERSION >= NTDDI_WS03)
    PACTIVATION_CONTEXT_STACK ActivationContextStackPointer;
    UCHAR                  SpareBytes1[0x34 - 3 * sizeof(PVOID)];
#else
    ACTIVATION_CONTEXT_STACK ActivationContextStack;
    UCHAR                  SpareBytes1[24];
#endif
    GDI_TEB_BATCH			GdiTebBatch;
    CLIENT_ID				RealClientId;
    PVOID					GdiCachedProcessHandle;
    ULONG                   GdiClientPID;
    ULONG                   GdiClientTID;
    PVOID					GdiThreadLocalInfo;
    PSIZE_T					Win32ClientInfo[62];
    PVOID					glDispatchTable[233];
    PSIZE_T					glReserved1[29];
    PVOID					glReserved2;
    PVOID					glSectionInfo;
    PVOID					glSection;
    PVOID					glTable;
    PVOID					glCurrentRC;
    PVOID					glContext;
    NTSTATUS                LastStatusValue;
    UNICODE_STRING			StaticUnicodeString;
    WCHAR                   StaticUnicodeBuffer[261];
    PVOID					DeallocationStack;
    PVOID					TlsSlots[64];
    LIST_ENTRY				TlsLinks;
    PVOID					Vdm;
    PVOID					ReservedForNtRpc;
    PVOID					DbgSsReserved[2];
#if (NTDDI_VERSION >= NTDDI_WS03)
    ULONG                   HardErrorMode;
#else
    ULONG                  HardErrorsAreDisabled;
#endif
#if (NTDDI_VERSION >= NTDDI_LONGHORN)
    PVOID					Instrumentation[13 - sizeof(GUID) / sizeof(PVOID)];
    GUID                    ActivityId;
    PVOID					SubProcessTag;
    PVOID					EtwLocalData;
    PVOID					EtwTraceData;
#elif (NTDDI_VERSION >= NTDDI_WS03)
    PVOID					Instrumentation[14];
    PVOID					SubProcessTag;
    PVOID					EtwLocalData;
#else
    PVOID					Instrumentation[16];
#endif
    PVOID					WinSockData;
    ULONG					GdiBatchCount;
#if (NTDDI_VERSION >= NTDDI_LONGHORN)
    BOOLEAN                SpareBool0;
    BOOLEAN                SpareBool1;
    BOOLEAN                SpareBool2;
#else
    BOOLEAN                InDbgPrint;
    BOOLEAN                FreeStackOnTermination;
    BOOLEAN                HasFiberData;
#endif
    UCHAR                  IdealProcessor;
#if (NTDDI_VERSION >= NTDDI_WS03)
    ULONG                  GuaranteedStackBytes;
#else
    ULONG                  Spare3;
#endif
    PVOID				   ReservedForPerf;
    PVOID				   ReservedForOle;
    ULONG                  WaitingOnLoaderLock;
#if (NTDDI_VERSION >= NTDDI_LONGHORN)
    PVOID				   SavedPriorityState;
    ULONG_PTR			   SoftPatchPtr1;
    ULONG_PTR			   ThreadPoolData;
#elif (NTDDI_VERSION >= NTDDI_WS03)
    ULONG_PTR			   SparePointer1;
    ULONG_PTR              SoftPatchPtr1;
    ULONG_PTR              SoftPatchPtr2;
#else
    Wx86ThreadState        Wx86Thread;
#endif
    PVOID* TlsExpansionSlots;
#if defined(_WIN64) && !defined(EXPLICIT_32BIT)
    PVOID                  DeallocationBStore;
    PVOID                  BStoreLimit;
#endif
    ULONG                  ImpersonationLocale;
    ULONG                  IsImpersonating;
    PVOID                  NlsCache;
    PVOID                  pShimData;
    ULONG                  HeapVirtualAffinity;
    HANDLE                 CurrentTransactionHandle;
    PTEB_ACTIVE_FRAME      ActiveFrame;
#if (NTDDI_VERSION >= NTDDI_WS03)
    PVOID FlsData;
#endif
#if (NTDDI_VERSION >= NTDDI_LONGHORN)
    PVOID PreferredLangauges;
    PVOID UserPrefLanguages;
    PVOID MergedPrefLanguages;
    ULONG MuiImpersonation;
    union
    {
        struct
        {
            USHORT SpareCrossTebFlags : 16;
        };
        USHORT CrossTebFlags;
    };
    union
    {
        struct
        {
            USHORT DbgSafeThunkCall : 1;
            USHORT DbgInDebugPrint : 1;
            USHORT DbgHasFiberData : 1;
            USHORT DbgSkipThreadAttach : 1;
            USHORT DbgWerInShipAssertCode : 1;
            USHORT DbgIssuedInitialBp : 1;
            USHORT DbgClonedThread : 1;
            USHORT SpareSameTebBits : 9;
        };
        USHORT SameTebFlags;
    };
    PVOID TxnScopeEntercallback;
    PVOID TxnScopeExitCAllback;
    PVOID TxnScopeContext;
    ULONG LockCount;
    ULONG ProcessRundown;
    ULONG64 LastSwitchTime;
    ULONG64 TotalSwitchOutTime;
    LARGE_INTEGER WaitReasonBitMap;
#else
    BOOLEAN SafeThunkCall;
    BOOLEAN BooleanSpare[3];
#endif
} TEB, * PTEB;


typedef LONG KPRIORITY;

typedef struct _PROCESS_BASIC_INFORMATION {
    NTSTATUS ExitStatus;
    PPEB PebBaseAddress;
    ULONG_PTR AffinityMask;
    KPRIORITY BasePriority;
    ULONG_PTR UniqueProcessId;
    ULONG_PTR InheritedFromUniqueProcessId;
} PROCESS_BASIC_INFORMATION, * PPROCESS_BASIC_INFORMATION;




#endif // !_STRUCTS_H
