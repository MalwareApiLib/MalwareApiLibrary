#include <Windows.h>
#include <stdio.h>
#include "ExpSyscallsManagement.h"

#pragma comment (lib, "SyscallsManagementLib.lib")

#define NtAllocateVirtualMemoryHASH     0x014044AE
#define NtProtectVirtualMemoryHASH      0xE67C7320
#define NtCreateThreadExHASH            0x93EC9D3D
#define Rotr32Seed                      0x7

int main() {
    //printf("[i] NtAllocateVirtualMemory : 0x%0.8X \n", HashStringRotr32A("NtAllocateVirtualMemory", 7));
    //printf("[i] NtProtectVirtualMemory : 0x%0.8X \n", HashStringRotr32A("NtProtectVirtualMemory", 7));
    //printf("[i] NtCreateThreadEx : 0x%0.8X \n", HashStringRotr32A("NtCreateThreadEx", 7));

    DWORD ERR0R;
    

    /*
    if (!InitializeSyscallviaHellsGate(NtAllocateVirtualMemoryHASH, Rotr32Seed, &ERR0R)) {
        printf("[-] ERR0R : %d \n", ERR0R);
    }
    */
    
    //-----------------------------------------------------------------------------------------------------------------------
    // Variables of the syscalls
    PVOID lpAddress = NULL;
    SIZE_T sDataSize = 0x100;
    DWORD ulOldProtect = NULL;
    //-----------------------------------------------------------------------------------------------------------------------
    // NtAllocateVirtualMemory
    if (!InitializeSyscallviaTartarus(NtAllocateVirtualMemoryHASH, Rotr32Seed, &ERR0R)) {
        printf("[-] ERR0R : %d \n", ERR0R);
    }
    SetSysNmbr(getSyscallNumber());
    RunSyscall((HANDLE)-1, &lpAddress, 0, &sDataSize, MEM_COMMIT, PAGE_READWRITE);
    printf("[+] lpAddress: 0x%p \n", lpAddress);
    //-----------------------------------------------------------------------------------------------------------------------
    // NtProtectVirtualMemory
    if (!InitializeSyscallviaTartarus(NtProtectVirtualMemoryHASH, Rotr32Seed, &ERR0R)) {
        printf("[-] ERR0R : %d \n", ERR0R);
    }
    SetSysNmbr(getSyscallNumber());
    RunSyscall((HANDLE)-1, &lpAddress, &sDataSize, PAGE_EXECUTE_READ, &ulOldProtect);
    //-----------------------------------------------------------------------------------------------------------------------

    /*
    if (!PerunsFart()) {
        return -1;
    }
    */

    printf("[i] Press Enter To Exit ... ");
    getchar();

    return 0;
}